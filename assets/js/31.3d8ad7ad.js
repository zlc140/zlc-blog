(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{353:function(t,s,n){"use strict";n.r(s);var a=n(1),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h2",{attrs:{id:"js事件循环"}},[t._v("js事件循环")]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),n("p",[t._v("结果: global - 1-2-3-4-5 - promise1 - then1 - 6 - timeout2 - timeout2_promise - timeout2_then - 6()")]),t._v(" "),t._m(3),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.im/post/5aacd1766fb9a028cb2d6766",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文献"),n("OutboundLink")],1)]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.im/post/5aa5dcabf265da239c7afe1e",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考文献1"),n("OutboundLink")],1)])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("js")]),this._v("执行为单线程，所有代码皆在主线程调用栈完成执行。当主线程任务清空后才会去轮询取任务队列中任务。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ol",[n("li",[n("p",[t._v("同步和异步\n同步：是指调用函数可以立刻得到结果 (调用后必须执行完才会继续下个任务)\n异步：调用函数后需要通过一定手段在将来得到结果"),n("code",[t._v("setTimeout")]),t._v(","),n("code",[t._v("promise")]),t._v(","),n("code",[t._v("ajax")]),t._v(","),n("code",[t._v("dom")]),t._v("事件 (调用后不需等待结果继续下个任务)")])]),t._v(" "),n("li",[n("p",[t._v("任务队列\n同步任务： 排队执行\n异步任务：不在主线程，而进入任务队列，等待队列通知到主线程可以执行了才会执行")])]),t._v(" "),n("li",[n("p",[t._v("执行顺序")]),t._v(" "),n("ul",[n("li",[t._v("同步任务在主线程执行，形成一个执行栈")]),t._v(" "),n("li",[t._v("但主线程为空时，检查任务队列是否为空，为空继续检查，不为空则继续c")]),t._v(" "),n("li",[t._v("去任务队列首位，压入执行栈")]),t._v(" "),n("li",[t._v("执行新任务")]),t._v(" "),n("li",[t._v("检查执行栈，为空则跳到b;不可则继续执行")])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("Event Loop")]),t._v(" (入栈出栈的循环)\n不同的异步函数执行放入不同的任务中 === 宏任务("),n("code",[t._v("macro-task")]),t._v(")  微任务("),n("code",[t._v("micro-task")]),t._v(")")]),t._v(" "),n("p",[n("code",[t._v("macro-task")]),t._v("包括： "),n("code",[t._v("script")]),t._v(","),n("code",[t._v("setTimeout")]),t._v(","),n("code",[t._v("setInterval")]),t._v(","),n("code",[t._v("setImmediate")]),t._v(","),n("code",[t._v("I/O")]),t._v(","),n("code",[t._v("UI redndering")]),t._v(" "),n("code",[t._v("micro-task")]),t._v("包括： "),n("code",[t._v("process.nextTick")]),t._v(","),n("code",[t._v("Promise")]),t._v(","),n("code",[t._v("Object.observe")]),t._v(","),n("code",[t._v("MutationObserver")])]),t._v(" "),n("ul",[n("li",[t._v("执行完主线程任务")]),t._v(" "),n("li",[t._v("取微任务执行到清空")]),t._v(" "),n("li",[t._v("取一个宏任务执行")]),t._v(" "),n("li",[t._v("取微任务执行到清空")]),t._v(" "),n("li",[t._v("重复c->d")])])]),t._v(" "),n("li",[n("p",[t._v("注意：\n其实"),n("code",[t._v("promise")]),t._v("的"),n("code",[t._v("then")]),t._v("和"),n("code",[t._v("catch")]),t._v("才是"),n("code",[t._v("microtask")]),t._v("，本身的内部代码不是。\n"),n("code",[t._v("script")]),t._v("标签的内容会被当成一个独立的"),n("code",[t._v("task")]),t._v(",即会执行完前面的"),n("code",[t._v("microtask")]),t._v(",才会继续执行下个"),n("code",[t._v("script")])]),t._v(" "),n("ul",[n("li",[t._v("浏览器和"),n("code",[t._v("node")]),t._v("中执行不一样")]),t._v(" "),n("li",[t._v("任务队列是先入先出")])])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'global'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'then1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeout2'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeout2_promise'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'timeout2_then'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     \n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"6"}},[s("li",[s("p",[this._v("宏任务 -》 该宏任务下的微任务 -》 渲染 -》 宏任务\n所以浏览器每次执行完一个宏任务之后就会渲染浏览器（这个和vue的$nextTick有关联，nextTick会首先判断浏览器是否支持微任务promise等，如果都不支持才会setTimeout）")])]),this._v(" "),s("li",[s("p",[this._v("async/await （本身就是promise+generator的语法糖，所以它是属于微任务）\n一直以为await会一直等表达式的代码执行完才会执行后边的js代码，实际上await是一个让出线程的标志。await后边的代码会执行一遍放到微任务中然后就跳出\n整个async函数继续执行函数之后的代码")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"node事件循环"}},[s("code",[this._v("node")]),this._v("事件循环")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("p",[t._v("在"),n("code",[t._v("node")]),t._v("中事件每一轮循环按照顺序分为6个阶段，来自"),n("code",[t._v("libuv")]),t._v("的实现：")]),t._v(" "),n("ol",[n("li",[n("code",[t._v("timers")]),t._v("：执行满足条件的"),n("code",[t._v("setTimeout")]),t._v("、"),n("code",[t._v("setInterval")]),t._v("回调。")]),t._v(" "),n("li",[n("code",[t._v("I/O callbacks")]),t._v("：是否有已完成的"),n("code",[t._v("I/O")]),t._v("操作的回调函数，来自上一轮的"),n("code",[t._v("poll")]),t._v("残留。")]),t._v(" "),n("li",[n("code",[t._v("idle")]),t._v("，"),n("code",[t._v("prepare")]),t._v("：可忽略")]),t._v(" "),n("li",[n("code",[t._v("poll")]),t._v("：等待还没完成的"),n("code",[t._v("I/O")]),t._v("事件，会因"),n("code",[t._v("timers")]),t._v("和超时时间等结束等待。")]),t._v(" "),n("li",[n("code",[t._v("check")]),t._v("：执行"),n("code",[t._v("setImmediate")]),t._v("的回调。")]),t._v(" "),n("li",[n("code",[t._v("close callbacks")]),t._v("：关闭所有的"),n("code",[t._v("closing handles")]),t._v("，一些"),n("code",[t._v("onclose")]),t._v("事件。")])])])])}],!1,null,null,null);s.default=e.exports}}]);